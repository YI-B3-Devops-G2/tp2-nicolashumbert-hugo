version: '3.1'

services:
    nodejs:
      build:
        context: ../
        dockerfile: Docker/nodejs/Dockerfile
      container_name: devops_api_nodejs
      environment:
        - NODE_ENV=production
        - PORT=36301
        - DB_USER=admin
        - DB_PASSWORD=azerty@123
        - DB_NAME=test
        - DB_HOST=devops_postgres
      depends_on:
        - postgres
    postgres:
      image: postgres
      container_name: devops_postgres
      environment:
        POSTGRES_DB: test
        POSTGRES_USER: admin
        POSTGRES_PASSWORD: azerty@123
        PGDATA: /data/postgres
      restart: unless-stopped
    redis:
      image: redis
      container_name: devops_redis
    nginx:
      build:
        context: ./nginx
        dockerfile: Dockerfile
      environment:
        - HOSTNAME=devops_tp_nodejs:36301
      depends_on:
        - nodejs
      ports:
        - 3000:3000
